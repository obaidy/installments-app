(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[716],{3745:function(e,t,s){Promise.resolve().then(s.bind(s,2727))},2727:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var n=s(7437),a=s(2265),r=s(6463),i=s(8935);function o(){let e=(0,r.useRouter)(),t=(0,r.useSearchParams)(),[s,o]=(0,a.useState)(""),[u,l]=(0,a.useState)(""),[c,d]=(0,a.useState)(null),m=t.get("next")||"/";async function f(t){var n,a,r;t.preventDefault(),d(null);let{error:o}=await i.O.auth.signInWithPassword({email:s,password:u});if(o){d(o.message);return}try{let{data:e}=await i.O.auth.getSession(),t=null===(a=e.session)||void 0===a?void 0:a.access_token,s=null===(r=e.session)||void 0===r?void 0:r.refresh_token;t&&(document.cookie="sb-access-token=".concat(t,"; Max-Age=").concat(604800,"; Path=/; SameSite=Lax")),s&&(document.cookie="sb-refresh-token=".concat(s,"; Max-Age=").concat(604800,"; Path=/; SameSite=Lax"))}catch(e){}let{data:l}=await i.O.auth.getUser(),c=null===(n=l.user)||void 0===n?void 0:n.id;if(!c){d("Login failed");return}let{data:f}=await i.O.from("user_status").select("status").eq("user_id",c).single();if(!f||"approved"!==f.status){d("User is not approved yet");return}let{data:p}=await i.O.from("user_roles").select("role").eq("user_id",c).single();"admin"===(null==p?void 0:p.role)?e.replace(m||"/"):e.replace("/not-authorized")}return(0,a.useEffect)(()=>{(async()=>{let{data:t}=await i.O.auth.getUser();t.user&&e.replace("/")})()},[e]),(0,n.jsx)("main",{className:"min-h-dvh flex items-center justify-center p-6",children:(0,n.jsxs)("form",{onSubmit:f,className:"w-full max-w-sm space-y-4 bg-card text-card-foreground p-6 rounded-lg shadow-card",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold",children:"Admin Login"}),c?(0,n.jsx)("p",{className:"text-sm text-red-600",children:c}):null,(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"text-sm",children:"Email"}),(0,n.jsx)("input",{className:"w-full rounded-md border border-border bg-transparent px-3 py-2 outline-none focus:ring-2 focus:ring-ring",type:"email",value:s,onChange:e=>o(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"text-sm",children:"Password"}),(0,n.jsx)("input",{className:"w-full rounded-md border border-border bg-transparent px-3 py-2 outline-none focus:ring-2 focus:ring-ring",type:"password",value:u,onChange:e=>l(e.target.value),required:!0})]}),(0,n.jsx)("button",{type:"submit",className:"h-9 rounded-md bg-primary text-primary-foreground px-4",children:"Sign in"})]})})}},8935:function(e,t,s){"use strict";s.d(t,{O:function(){return i}});var n=s(9317);let{url:a,anonKey:r}=function(){let e="https://ulfucdrhbmmfqgqpcgsf.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVsZnVjZHJoYm1tZnFncXBjZ3NmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzMzA1NjAsImV4cCI6MjA2NDkwNjU2MH0.Q8i0BiqN_D0IFOBIzF5MLvd564ZO9xeAJokuAWq_lmQ";if(!e||!t)throw Error("Supabase URL/Anon key missing in env");return{url:e,anonKey:t}}(),i=(0,n.eI)(a,r)}},function(e){e.O(0,[598,971,23,744],function(){return e(e.s=3745)}),_N_E=e.O()}]);