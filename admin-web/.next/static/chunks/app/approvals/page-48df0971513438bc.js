(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[163],{518:function(e,s,t){Promise.resolve().then(t.bind(t,6987))},6987:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var r=t(7437),a=t(2265),i=t(2183),n=t(8935);function d(){let[e,s]=(0,a.useState)([]),[t,d]=(0,a.useState)([]),[l,c]=(0,a.useState)(null);async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"client";await n.O.from("user_status").upsert({user_id:e,status:"approved",approved_by:l,approved_at:new Date().toISOString()}),await n.O.from("user_roles").upsert({user_id:e,role:t}),await n.O.from("audit_log").insert({actor:l,action:"approve_user",entity:"auth.users",entity_id:e,meta:{role:t}}),s(s=>s.filter(s=>s.user_id!==e))}async function u(e,s){await n.O.from("client_complex_status").upsert({user_id:e,complex_id:s,status:"approved",approved_by:l,approved_at:new Date().toISOString()}),await n.O.from("audit_log").insert({actor:l,action:"approve_client",entity:"client_complex_status",entity_id:"".concat(e,":").concat(s)}),d(t=>t.filter(t=>!(t.user_id===e&&t.complex_id===s)))}return(0,a.useEffect)(()=>{(async()=>{var e;c((null===(e=(await n.O.auth.getUser()).data.user)||void 0===e?void 0:e.id)||null);let{data:t}=await n.O.from("user_status").select("user_id, status").eq("status","pending");s(t||[]);let{data:r}=await n.O.from("client_complex_status").select("user_id, complex_id, status, complexes(name)").eq("status","pending");d(r||[])})()},[]),(0,r.jsxs)(i.N,{children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Approvals"}),(0,r.jsxs)("section",{className:"space-y-2 mb-8",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Users"}),0===e.length?(0,r.jsx)("div",{className:"text-sm opacity-70",children:"No pending users"}):null,(0,r.jsx)("ul",{className:"space-y-2",children:e.map(e=>(0,r.jsxs)("li",{className:"flex items-center justify-between border border-border rounded-md px-3 py-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm",children:e.user_id}),(0,r.jsxs)("div",{className:"text-xs opacity-70",children:["status: ",e.status]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>o(e.user_id,"client"),children:"Approve Client"}),(0,r.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>o(e.user_id,"manager"),children:"Approve Manager"}),(0,r.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>o(e.user_id,"accountant"),children:"Approve Accountant"})]})]},e.user_id))})]}),(0,r.jsxs)("section",{className:"space-y-2",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Clients per Complex"}),0===t.length?(0,r.jsx)("div",{className:"text-sm opacity-70",children:"No pending client-complex approvals"}):null,(0,r.jsx)("ul",{className:"space-y-2",children:t.map(e=>{var s;return(0,r.jsxs)("li",{className:"flex items-center justify-between border border-border rounded-md px-3 py-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm",children:e.user_id}),(0,r.jsxs)("div",{className:"text-xs opacity-70",children:["complex: ",(null===(s=e.complexes)||void 0===s?void 0:s.name)||e.complex_id," â€¢ status: ",e.status]})]}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>u(e.user_id,e.complex_id),children:"Approve"})})]},"".concat(e.user_id,":").concat(e.complex_id))})})]})]})}}},function(e){e.O(0,[598,138,183,971,23,744],function(){return e(e.s=518)}),_N_E=e.O()}]);