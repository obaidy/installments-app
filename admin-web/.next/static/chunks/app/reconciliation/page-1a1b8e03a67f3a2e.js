(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[994],{4603:function(e,t,s){Promise.resolve().then(s.bind(s,8188))},8188:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var a=s(7437),r=s(2265),l=s(2183),d=s(8935);function i(){let[e,t]=(0,r.useState)([]),[s,i]=(0,r.useState)(""),[n,c]=(0,r.useState)(!1),[o,m]=(0,r.useState)(null);async function u(){let{data:e}=await d.O.from("payments").select("id, amount, status, provider, provider_ref, paid_at").order("paid_at",{ascending:!1}).limit(1e3);t(e||[])}(0,r.useEffect)(()=>{u()},[]);let h=(0,r.useMemo)(()=>{let t=s.toLowerCase().trim();return t?e.filter(e=>(e.provider_ref||"").toLowerCase().includes(t)):e},[e,s]);return(0,a.jsxs)(l.N,{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Reconciliation"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)("input",{className:"rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Search by provider ref",value:s,onChange:e=>i(e.target.value)}),(0,a.jsx)("div",{className:"flex-1"}),(0,a.jsxs)("form",{onSubmit:async e=>{var t,s;e.preventDefault();let a=null===(s=e.currentTarget.elements.namedItem("file"))||void 0===s?void 0:null===(t=s.files)||void 0===t?void 0:t[0];if(a){c(!0);try{let e=new FormData;e.append("file",a);let t=await fetch("".concat("http://localhost:3001","/reconcile/upload"),{method:"POST",body:e}),s=await t.json();m(s.summary)}finally{c(!1)}}},children:[(0,a.jsx)("input",{type:"file",name:"file",accept:".csv,text/csv"}),(0,a.jsx)("button",{disabled:n,className:"ml-2 px-3 py-1.5 rounded-md border border-border",children:n?"Uploading…":"Upload CSV"})]})]}),o?(0,a.jsxs)("div",{className:"mb-4 text-sm",children:["Matched: ",o.matched," • Missing: ",o.missing," • Mismatched: ",o.mismatched]}):null,(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg border border-border",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-muted/40",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-2 text-left",children:"Provider"}),(0,a.jsx)("th",{className:"p-2 text-left",children:"Ref"}),(0,a.jsx)("th",{className:"p-2 text-left",children:"Amount"}),(0,a.jsx)("th",{className:"p-2 text-left",children:"Status"}),(0,a.jsx)("th",{className:"p-2 text-left",children:"Paid At"})]})}),(0,a.jsx)("tbody",{children:h.map(e=>(0,a.jsxs)("tr",{className:"border-t border-border",children:[(0,a.jsx)("td",{className:"p-2",children:e.provider||"-"}),(0,a.jsx)("td",{className:"p-2",children:e.provider_ref||"-"}),(0,a.jsx)("td",{className:"p-2",children:e.amount}),(0,a.jsx)("td",{className:"p-2",children:e.status}),(0,a.jsx)("td",{className:"p-2",children:e.paid_at?new Date(e.paid_at).toLocaleString():"-"})]},e.id))})]})})]})}}},function(e){e.O(0,[598,138,183,971,23,744],function(){return e(e.s=4603)}),_N_E=e.O()}]);