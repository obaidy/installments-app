(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[545],{1098:function(e,t,r){Promise.resolve().then(r.bind(r,9104))},9104:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7437),l=r(2265),s=r(2183),a=r(361),i=r(5057),d=r(1962),o=r(8935),c=r(1700);function u(){let[e,t]=(0,l.useState)(""),[r,u]=(0,l.useState)([]),[m,x]=(0,l.useState)(!0),[p,b]=(0,l.useState)(0),[h,f]=(0,l.useState)(!1),[g,j]=(0,l.useState)([]),[y,N]=(0,l.useState)(!1),[v,k]=(0,l.useState)(""),[S,w]=(0,l.useState)(""),[C,_]=(0,l.useState)(null),[O,E]=(0,l.useState)({}),[L,U]=(0,l.useState)("");async function R(e){x(!0);let t=50*e,[{data:r},{data:n}]=await Promise.all([o.O.from("units").select("id, name, complex_id, complexes(name)").order("name").range(t,t+50-1),o.O.from("complexes").select("id, name").order("name")]);u((r||[]).map(e=>{var t;return{id:e.id,name:e.name,complex_id:e.complex_id,complex:null===(t=e.complexes)||void 0===t?void 0:t.name}})),j(n||[]),f(50===(r||[]).length),x(!1)}(0,l.useEffect)(()=>{R(p)},[p]);let A=(0,l.useMemo)(()=>{let t=e.toLowerCase().trim();return t?r.filter(e=>e.name.toLowerCase().includes(t)||(e.complex||"").toLowerCase().includes(t)):r},[r,e]),F=(0,l.useMemo)(()=>A.filter(e=>O[String(e.id)]),[A,O]);async function M(){U("");let e="number"==typeof S?S:S?Number(S):NaN;if(!v.trim()||!e||Number.isNaN(e)){U("Please enter a name and select a complex.");return}try{if(C){let{error:t}=await o.O.from("units").update({name:v.trim(),complex_id:e}).eq("id",C);if(t)throw t;await R(p)}else{let{data:t,error:r}=await o.O.from("units").insert({name:v.trim(),complex_id:e}).select("id").single();if(r)throw r;t&&u(r=>{var n;return[{id:t.id,name:v.trim(),complex_id:e,complex:null===(n=g.find(t=>t.id===e))||void 0===n?void 0:n.name},...r]})}N(!1),_(null)}catch(e){U((null==e?void 0:e.message)||"Failed to save unit")}}async function P(e){await o.O.from("units").delete().eq("id",e),u(t=>t.filter(t=>t.id!==e))}async function q(){let e=F.map(e=>e.id);e.length&&(await o.O.from("units").delete().in("id",e),u(t=>t.filter(t=>!e.includes(t.id))),E({}))}return(0,n.jsxs)(s.N,{children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold mb-2",children:"Units"}),(0,n.jsx)(a.o,{query:e,setQuery:t,onSearch:()=>{},right:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(c.j,{filename:"units.csv",columns:[{key:"name",label:"Name"},{key:"complex",label:"Complex"}],rows:F.length?F:A}),(0,n.jsxs)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:0===F.length,onClick:q,children:["Delete Selected (",F.length,")"]}),(0,n.jsx)("button",{className:"rounded-md bg-primary text-primaryForeground px-3 py-2 text-sm",onClick:()=>{_(null),k(""),w(""),N(!0)},children:"Add Unit"})]})}),(0,n.jsx)(i.w,{columns:[{key:"name",label:"Name"},{key:"complex",label:"Complex"},{key:"id",label:"Actions",width:"200px",render:e=>(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>{_(e.id),k(e.name),w(e.complex_id||""),N(!0)},children:"Edit"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>P(e.id),children:"Delete"})]})}],rows:A,selectable:!0,selected:O,onToggleRow:e=>E(t=>({...t,[String(e.id)]:!t[String(e.id)]})),onToggleAll:e=>{let t={};e&&A.forEach(e=>t[String(e.id)]=!0),E(t)}}),m?(0,n.jsx)("div",{className:"mt-2 text-sm opacity-70",children:"Loading…"}):null,(0,n.jsxs)("div",{className:"flex items-center justify-end gap-2 mt-3",children:[(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:0===p,onClick:()=>b(e=>Math.max(0,e-1)),children:"Prev"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:!h,onClick:()=>b(e=>e+1),children:"Next"})]}),(0,n.jsxs)(d.u,{open:y,onClose:()=>N(!1),title:C?"Edit Unit":"Add Unit",children:[(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)("label",{className:"text-sm",children:"Name"}),(0,n.jsx)("input",{className:"rounded-md border border-input bg-background px-3 py-2 text-sm",value:v,onChange:e=>k(e.target.value)}),(0,n.jsx)("label",{className:"text-sm",children:"Complex"}),(0,n.jsxs)("select",{className:"rounded-md border border-input bg-background px-3 py-2 text-sm",value:S,onChange:e=>{let t=e.target.value;w(t?Number(t):"")},children:[(0,n.jsx)("option",{value:"",children:"Select…"}),g.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),L?(0,n.jsx)("div",{className:"text-red-600 text-sm mt-1",children:L}):null]}),(0,n.jsx)("div",{className:"mt-3 flex justify-end",children:(0,n.jsx)("button",{className:"rounded-md bg-primary text-primaryForeground px-3 py-2 text-sm",onClick:M,children:"Save"})})]})]})}},5057:function(e,t,r){"use strict";r.d(t,{w:function(){return s}});var n=r(7437),l=r(2265);function s(e){let{columns:t,rows:r,selectable:s,selected:a,onToggleRow:i,onToggleAll:d}=e,[o,c]=(0,l.useState)(null),[u,m]=(0,l.useState)("asc"),x=(0,l.useMemo)(()=>{if(!o)return r;let e=[...r];return e.sort((e,t)=>{let r=e[o],n=t[o];return r<n?"asc"===u?-1:1:r>n?"asc"===u?1:-1:0}),e},[r,o,u]),p=e=>{let{active:t}=e;return(0,n.jsx)("span",{className:"ml-1 text-xs opacity-70",children:t?"asc"===u?"↑":"↓":"↕"})},b=s&&a&&r.length>0&&r.every(e=>a[String(e.id)]);return s&&a&&r.some(e=>a[String(e.id)]),(0,n.jsx)("div",{className:"overflow-x-auto rounded-lg border border-border",children:(0,n.jsxs)("table",{className:"min-w-full text-sm",children:[(0,n.jsx)("thead",{className:"bg-muted/40 sticky top-0 z-10 backdrop-blur",children:(0,n.jsxs)("tr",{children:[s?(0,n.jsx)("th",{className:"p-3 w-[42px]",children:(0,n.jsx)("input",{type:"checkbox","aria-label":"Select all rows",checked:!!b,onChange:e=>null==d?void 0:d(e.target.checked)})}):null,t.map(e=>(0,n.jsxs)("th",{className:"text-left p-3 cursor-pointer select-none",style:{width:e.width},onClick:()=>{var t;o===(t=e.key)?m(e=>"asc"===e?"desc":"asc"):(c(t),m("asc"))},children:[e.label,(0,n.jsx)(p,{active:o===e.key})]},String(e.key)))]})}),(0,n.jsx)("tbody",{className:"bg-card",children:x.map((e,r)=>(0,n.jsxs)("tr",{className:"border-t border-border transition-colors "+(r%2==1?"bg-muted/10 ":"")+(s&&a&&a[String(e.id)]?" bg-primary/5 ":"")+"hover:bg-muted/20",children:[s?(0,n.jsx)("td",{className:"p-3 w-[42px]",children:(0,n.jsx)("input",{type:"checkbox","aria-label":"Select row ".concat(String(e.id)),checked:!!(null==a?void 0:a[String(e.id)]),onChange:()=>null==i?void 0:i(e)})}):null,t.map(t=>(0,n.jsx)("td",{className:"p-3",children:t.render?t.render(e):e[t.key]},String(t.key)))]},String(e.id)))})]})})}},1700:function(e,t,r){"use strict";r.d(t,{j:function(){return l}});var n=r(7437);function l(e){let{filename:t,columns:r,rows:l}=e;return(0,n.jsx)("button",{className:"rounded-md border border-border px-3 py-2 text-sm",onClick:function(){let e=new Blob([r.map(e=>s(String(e.label))).join(",")+"\n"+l.map(e=>r.map(t=>{var r;return s(null==(r=e[t.key])?"":r instanceof Date?r.toISOString():String(r))}).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,a.click(),URL.revokeObjectURL(n)},title:"Export CSV",children:"Export CSV"})}function s(e){return e.includes(",")||e.includes('"')||e.includes("\n")?'"'+e.replace(/"/g,'""')+'"':e}r(2265)},361:function(e,t,r){"use strict";r.d(t,{o:function(){return l}});var n=r(7437);function l(e){let{query:t,setQuery:r,onSearch:l,right:s}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,n.jsx)("input",{className:"w-full md:w-auto flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Search…",value:t,onChange:e=>r(e.target.value)}),(0,n.jsx)("button",{className:"rounded-md bg-primary text-primaryForeground px-3 py-2 text-sm",onClick:l,children:"Search"}),s]})}r(2265)},1962:function(e,t,r){"use strict";r.d(t,{u:function(){return l}});var n=r(7437);function l(e){let{open:t,onClose:r,title:l,children:s}=e;return t?(0,n.jsxs)("div",{className:"fixed inset-0 z-40 flex items-center justify-center",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:r}),(0,n.jsxs)("div",{className:"relative z-10 w-full max-w-md rounded-lg border border-border bg-card p-4 shadow-card",children:[l?(0,n.jsx)("div",{className:"text-lg font-semibold mb-2",children:l}):null,(0,n.jsx)("div",{className:"space-y-3",children:s}),(0,n.jsx)("div",{className:"mt-4 flex justify-end gap-2",children:(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:r,children:"Close"})})]})]}):null}r(2265)}},function(e){e.O(0,[598,138,183,971,23,744],function(){return e(e.s=1098)}),_N_E=e.O()}]);