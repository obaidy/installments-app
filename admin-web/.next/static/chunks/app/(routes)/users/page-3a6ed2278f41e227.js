(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[109],{6433:function(e,r,t){Promise.resolve().then(t.bind(t,852))},852:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return c}});var n=t(7437),l=t(2265),s=t(2183),a=t(361),d=t(5057),i=t(8935),o=t(1700);function c(){let[e,r]=(0,l.useState)(""),[t,c]=(0,l.useState)([]),[m,b]=(0,l.useState)(!0),[p,x]=(0,l.useState)(0),[h,g]=(0,l.useState)(!1),[f,j]=(0,l.useState)({});async function y(e){b(!0);let r=50*e,{data:t}=await i.O.from("user_roles").select("user_id, role, profiles(email, full_name)").order("role").range(r,r+50-1),n=(t||[]).map(e=>{var r,t;return{id:e.user_id,role:e.role,email:null===(r=e.profiles)||void 0===r?void 0:r.email,name:null===(t=e.profiles)||void 0===t?void 0:t.full_name}});c(n),g(50===n.length),b(!1)}(0,l.useEffect)(()=>{y(p)},[p]);let v=(0,l.useMemo)(()=>{let r=e.toLowerCase().trim();return r?t.filter(e=>e.id.toLowerCase().includes(r)||e.role.toLowerCase().includes(r)):t},[t,e]),k=(0,l.useMemo)(()=>v.filter(e=>f[String(e.id)]),[v,f]);async function N(e,r){await i.O.from("user_roles").upsert({user_id:e,role:r}),c(t=>t.map(t=>t.id===e?{...t,role:r}:t))}async function S(e){await i.O.from("user_roles").delete().eq("user_id",e),c(r=>r.filter(r=>r.id!==e))}async function w(e){let r=k.map(e=>e.id);r.length&&(await i.O.from("user_roles").upsert(r.map(r=>({user_id:r,role:e}))),c(t=>t.map(t=>r.includes(t.id)?{...t,role:e}:t)),j({}))}async function C(){let e=k.map(e=>e.id);e.length&&(await i.O.from("user_roles").delete().in("user_id",e),c(r=>r.filter(r=>!e.includes(r.id))),j({}))}function _(e){return"admin"===e?"manager":"manager"===e?"client":"admin"}return(0,n.jsxs)(s.N,{children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold mb-2",children:"Users"}),(0,n.jsx)(a.o,{query:e,setQuery:r,onSearch:()=>{},right:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(o.j,{filename:"users.csv",columns:[{key:"email",label:"Email"},{key:"role",label:"Role"}],rows:k.length?k:v}),(0,n.jsxs)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:0===k.length,onClick:()=>w("manager"),children:["Make Manager (",k.length,")"]}),(0,n.jsxs)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:0===k.length,onClick:C,children:["Remove (",k.length,")"]}),(0,n.jsx)(u,{onInvited:()=>window.location.reload()})]})}),(0,n.jsx)(d.w,{columns:[{key:"email",label:"Email",render:e=>e.email||e.id},{key:"role",label:"Role",width:"140px",render:e=>(0,n.jsx)("span",{className:"inline-flex rounded-full border border-border px-2 py-0.5 text-xs bg-muted/30",children:e.role.toUpperCase()})},{key:"id",label:"Actions",width:"260px",render:e=>(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>N(e.id,_(e.role)),children:["Make ",_(e.role)]}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>S(e.id),children:"Remove"})]})}],rows:v,selectable:!0,selected:f,onToggleRow:e=>j(r=>({...r,[String(e.id)]:!r[String(e.id)]})),onToggleAll:e=>{let r={};e&&v.forEach(e=>r[String(e.id)]=!0),j(r)}}),(0,n.jsxs)("div",{className:"flex items-center justify-end gap-2 mt-3",children:[(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:0===p,onClick:()=>x(e=>Math.max(0,e-1)),children:"Prev"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:!h,onClick:()=>x(e=>e+1),children:"Next"})]}),m?(0,n.jsx)("div",{className:"mt-2 text-sm opacity-70",children:"Loading…"}):null]})}function u(e){let{onInvited:r}=e,[t,s]=(0,l.useState)(!1),[a,d]=(0,l.useState)(""),[i,o]=(0,l.useState)("client");async function c(){(await fetch("".concat("http://localhost:3001","/auth/invite"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:a,role:i})})).ok&&(s(!1),r())}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"rounded-md bg-primary text-primaryForeground px-3 py-2 text-sm",onClick:()=>s(!0),children:"Invite"}),t?(0,n.jsx)("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:()=>s(!1),children:(0,n.jsxs)("div",{className:"absolute right-4 top-16 bg-card border border-border rounded-md p-4 w-[320px]",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("div",{className:"text-sm font-semibold mb-2",children:"Invite user"}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)("input",{className:"rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"email@example.com",value:a,onChange:e=>d(e.target.value)}),(0,n.jsxs)("select",{className:"rounded-md border border-input bg-background px-3 py-2 text-sm",value:i,onChange:e=>o(e.target.value),children:[(0,n.jsx)("option",{value:"client",children:"Client"}),(0,n.jsx)("option",{value:"manager",children:"Manager"}),(0,n.jsx)("option",{value:"accountant",children:"Accountant"})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>s(!1),children:"Cancel"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:c,children:"Send Invite"})]})]})]})}):null]})}},5057:function(e,r,t){"use strict";t.d(r,{w:function(){return s}});var n=t(7437),l=t(2265);function s(e){let{columns:r,rows:t,selectable:s,selected:a,onToggleRow:d,onToggleAll:i}=e,[o,c]=(0,l.useState)(null),[u,m]=(0,l.useState)("asc"),b=(0,l.useMemo)(()=>{if(!o)return t;let e=[...t];return e.sort((e,r)=>{let t=e[o],n=r[o];return t<n?"asc"===u?-1:1:t>n?"asc"===u?1:-1:0}),e},[t,o,u]),p=e=>{let{active:r}=e;return(0,n.jsx)("span",{className:"ml-1 text-xs opacity-70",children:r?"asc"===u?"↑":"↓":"↕"})},x=s&&a&&t.length>0&&t.every(e=>a[String(e.id)]);return s&&a&&t.some(e=>a[String(e.id)]),(0,n.jsx)("div",{className:"overflow-x-auto rounded-lg border border-border",children:(0,n.jsxs)("table",{className:"min-w-full text-sm",children:[(0,n.jsx)("thead",{className:"bg-muted/40 sticky top-0 z-10 backdrop-blur",children:(0,n.jsxs)("tr",{children:[s?(0,n.jsx)("th",{className:"p-3 w-[42px]",children:(0,n.jsx)("input",{type:"checkbox","aria-label":"Select all rows",checked:!!x,onChange:e=>null==i?void 0:i(e.target.checked)})}):null,r.map(e=>(0,n.jsxs)("th",{className:"text-left p-3 cursor-pointer select-none",style:{width:e.width},onClick:()=>{var r;o===(r=e.key)?m(e=>"asc"===e?"desc":"asc"):(c(r),m("asc"))},children:[e.label,(0,n.jsx)(p,{active:o===e.key})]},String(e.key)))]})}),(0,n.jsx)("tbody",{className:"bg-card",children:b.map((e,t)=>(0,n.jsxs)("tr",{className:"border-t border-border transition-colors "+(t%2==1?"bg-muted/10 ":"")+(s&&a&&a[String(e.id)]?" bg-primary/5 ":"")+"hover:bg-muted/20",children:[s?(0,n.jsx)("td",{className:"p-3 w-[42px]",children:(0,n.jsx)("input",{type:"checkbox","aria-label":"Select row ".concat(String(e.id)),checked:!!(null==a?void 0:a[String(e.id)]),onChange:()=>null==d?void 0:d(e)})}):null,r.map(r=>(0,n.jsx)("td",{className:"p-3",children:r.render?r.render(e):e[r.key]},String(r.key)))]},String(e.id)))})]})})}},1700:function(e,r,t){"use strict";t.d(r,{j:function(){return l}});var n=t(7437);function l(e){let{filename:r,columns:t,rows:l}=e;return(0,n.jsx)("button",{className:"rounded-md border border-border px-3 py-2 text-sm",onClick:function(){let e=new Blob([t.map(e=>s(String(e.label))).join(",")+"\n"+l.map(e=>t.map(r=>{var t;return s(null==(t=e[r.key])?"":t instanceof Date?t.toISOString():String(t))}).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=r,a.click(),URL.revokeObjectURL(n)},title:"Export CSV",children:"Export CSV"})}function s(e){return e.includes(",")||e.includes('"')||e.includes("\n")?'"'+e.replace(/"/g,'""')+'"':e}t(2265)},361:function(e,r,t){"use strict";t.d(r,{o:function(){return l}});var n=t(7437);function l(e){let{query:r,setQuery:t,onSearch:l,right:s}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,n.jsx)("input",{className:"w-full md:w-auto flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Search…",value:r,onChange:e=>t(e.target.value)}),(0,n.jsx)("button",{className:"rounded-md bg-primary text-primaryForeground px-3 py-2 text-sm",onClick:l,children:"Search"}),s]})}t(2265)}},function(e){e.O(0,[598,138,183,971,23,744],function(){return e(e.s=6433)}),_N_E=e.O()}]);