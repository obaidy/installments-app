(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[46],{766:function(e,t,r){Promise.resolve().then(r.bind(r,9927))},9927:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(7437),a=r(2265),d=r(2183),s=r(361),l=r(5057),i=r(8935),o=r(1700),u=r(7003);function c(){let[e,t]=(0,a.useState)(""),[r,c]=(0,a.useState)([]),[m,b]=(0,a.useState)("all"),[p,x]=(0,a.useState)(!0),[g,h]=(0,a.useState)(0),[y,f]=(0,a.useState)(!1),[j,k]=(0,a.useState)({});async function S(e){x(!0);let t=new Date,r=50*e,{data:n}=await i.O.from("installments").select("id, amount_iqd, due_date, paid, units(name)").order("due_date",{ascending:!0}).range(r,r+50-1),a=(n||[]).map(e=>{var r;let n=new Date(e.due_date),a=e.paid?"paid":n<t?"overdue":"due";return{id:e.id,unit:(null===(r=e.units)||void 0===r?void 0:r.name)||"-",amount:e.amount_iqd,dueDate:e.due_date,status:a}});c(a),f(50===a.length),x(!1)}(0,a.useEffect)(()=>{S(g)},[g]);let v=(0,a.useMemo)(()=>{let t=e.toLowerCase().trim(),n=r;return"all"!==m&&(n=n.filter(e=>e.status===m)),t&&(n=n.filter(e=>e.unit.toLowerCase().includes(t))),n},[r,e,m]),N=(0,a.useMemo)(()=>v.filter(e=>j[String(e.id)]),[v,j]);async function w(e){await i.O.from("installments").update({paid:!0,paid_at:new Date().toISOString()}).eq("id",e),c(t=>t.map(t=>t.id===e?{...t,status:"paid"}:t))}async function C(){let e=N.map(e=>e.id);0!==e.length&&(await i.O.from("installments").update({paid:!0,paid_at:new Date().toISOString()}).in("id",e),c(t=>t.map(t=>e.includes(t.id)?{...t,status:"paid"}:t)),k({}))}return(0,n.jsx)(d.N,{children:(0,n.jsxs)("main",{className:"p-6 space-y-4",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:"Installments"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border "+("all"===m?"bg-muted/30":""),onClick:()=>b("all"),children:"All"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border "+("due"===m?"bg-muted/30":""),onClick:()=>b("due"),children:"Due"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border "+("overdue"===m?"bg-muted/30":""),onClick:()=>b("overdue"),children:"Past Due"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border "+("paid"===m?"bg-muted/30":""),onClick:()=>b("paid"),children:"Paid"})]}),(0,n.jsx)(s.o,{query:e,setQuery:t,onSearch:()=>{},right:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(o.j,{filename:"installments.csv",columns:[{key:"unit",label:"Unit"},{key:"dueDate",label:"Due"},{key:"amount",label:"Amount"},{key:"status",label:"Status"}],rows:N.length?N:v}),(0,n.jsxs)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:0===N.length,onClick:C,children:["Mark Paid (",N.length,")"]})]})}),(0,n.jsx)(l.w,{columns:[{key:"unit",label:"Unit"},{key:"dueDate",label:"Due",render:e=>(0,u.p)(e.dueDate,"en-IQ")},{key:"amount",label:"Amount",render:e=>(0,u.y)(e.amount,"en-IQ")},{key:"status",label:"Status",render:e=>(0,n.jsx)("span",{className:"px-2 py-0.5 rounded-full border text-xs "+("paid"===e.status?"bg-green-100 text-green-700 border-green-200":"overdue"===e.status?"bg-red-100 text-red-700 border-red-200":"bg-yellow-100 text-yellow-800 border-yellow-200"),children:e.status.toUpperCase()})},{key:"id",label:"Actions",width:"160px",render:e=>(0,n.jsx)("div",{className:"flex gap-2",children:"paid"!==e.status?(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>w(e.id),children:"Mark Paid"}):null})}],rows:v,selectable:!0,selected:j,onToggleRow:e=>k(t=>({...t,[String(e.id)]:!t[String(e.id)]})),onToggleAll:e=>{let t={};e&&v.forEach(e=>t[String(e.id)]=!0),k(t)}}),(0,n.jsxs)("div",{className:"flex items-center justify-end gap-2 mt-3",children:[(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:0===g,onClick:()=>h(e=>Math.max(0,e-1)),children:"Prev"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:!y,onClick:()=>h(e=>e+1),children:"Next"})]}),p?(0,n.jsx)("div",{className:"mt-2 text-sm opacity-70",children:"Loading…"}):null]})})}},5057:function(e,t,r){"use strict";r.d(t,{w:function(){return d}});var n=r(7437),a=r(2265);function d(e){let{columns:t,rows:r,selectable:d,selected:s,onToggleRow:l,onToggleAll:i}=e,[o,u]=(0,a.useState)(null),[c,m]=(0,a.useState)("asc"),b=(0,a.useMemo)(()=>{if(!o)return r;let e=[...r];return e.sort((e,t)=>{let r=e[o],n=t[o];return r<n?"asc"===c?-1:1:r>n?"asc"===c?1:-1:0}),e},[r,o,c]),p=e=>{let{active:t}=e;return(0,n.jsx)("span",{className:"ml-1 text-xs opacity-70",children:t?"asc"===c?"↑":"↓":"↕"})},x=d&&s&&r.length>0&&r.every(e=>s[String(e.id)]);return d&&s&&r.some(e=>s[String(e.id)]),(0,n.jsx)("div",{className:"overflow-x-auto rounded-lg border border-border",children:(0,n.jsxs)("table",{className:"min-w-full text-sm",children:[(0,n.jsx)("thead",{className:"bg-muted/40 sticky top-0 z-10 backdrop-blur",children:(0,n.jsxs)("tr",{children:[d?(0,n.jsx)("th",{className:"p-3 w-[42px]",children:(0,n.jsx)("input",{type:"checkbox","aria-label":"Select all rows",checked:!!x,onChange:e=>null==i?void 0:i(e.target.checked)})}):null,t.map(e=>(0,n.jsxs)("th",{className:"text-left p-3 cursor-pointer select-none",style:{width:e.width},onClick:()=>{var t;o===(t=e.key)?m(e=>"asc"===e?"desc":"asc"):(u(t),m("asc"))},children:[e.label,(0,n.jsx)(p,{active:o===e.key})]},String(e.key)))]})}),(0,n.jsx)("tbody",{className:"bg-card",children:b.map((e,r)=>(0,n.jsxs)("tr",{className:"border-t border-border transition-colors "+(r%2==1?"bg-muted/10 ":"")+(d&&s&&s[String(e.id)]?" bg-primary/5 ":"")+"hover:bg-muted/20",children:[d?(0,n.jsx)("td",{className:"p-3 w-[42px]",children:(0,n.jsx)("input",{type:"checkbox","aria-label":"Select row ".concat(String(e.id)),checked:!!(null==s?void 0:s[String(e.id)]),onChange:()=>null==l?void 0:l(e)})}):null,t.map(t=>(0,n.jsx)("td",{className:"p-3",children:t.render?t.render(e):e[t.key]},String(t.key)))]},String(e.id)))})]})})}},1700:function(e,t,r){"use strict";r.d(t,{j:function(){return a}});var n=r(7437);function a(e){let{filename:t,columns:r,rows:a}=e;return(0,n.jsx)("button",{className:"rounded-md border border-border px-3 py-2 text-sm",onClick:function(){let e=new Blob([r.map(e=>d(String(e.label))).join(",")+"\n"+a.map(e=>r.map(t=>{var r;return d(null==(r=e[t.key])?"":r instanceof Date?r.toISOString():String(r))}).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(e),s=document.createElement("a");s.href=n,s.download=t,s.click(),URL.revokeObjectURL(n)},title:"Export CSV",children:"Export CSV"})}function d(e){return e.includes(",")||e.includes('"')||e.includes("\n")?'"'+e.replace(/"/g,'""')+'"':e}r(2265)},361:function(e,t,r){"use strict";r.d(t,{o:function(){return a}});var n=r(7437);function a(e){let{query:t,setQuery:r,onSearch:a,right:d}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,n.jsx)("input",{className:"w-full md:w-auto flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Search…",value:t,onChange:e=>r(e.target.value)}),(0,n.jsx)("button",{className:"rounded-md bg-primary text-primaryForeground px-3 py-2 text-sm",onClick:a,children:"Search"}),d]})}r(2265)},7003:function(e,t,r){"use strict";function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-IQ";return new Intl.NumberFormat(t,{style:"currency",currency:"IQD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ar-IQ",r="string"==typeof e?new Date(e):e;return new Intl.DateTimeFormat(t,{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"UTC"}).format(r)}r.d(t,{p:function(){return a},y:function(){return n}})}},function(e){e.O(0,[598,138,183,971,23,744],function(){return e(e.s=766)}),_N_E=e.O()}]);