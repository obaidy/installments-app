(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[411],{3334:function(e,r,t){Promise.resolve().then(t.bind(t,2726))},2726:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return u}});var n=t(7437),l=t(2265),s=t(2183),d=t(361),a=t(5057),i=t(1962),o=t(8935),c=t(1700);function u(){let[e,r]=(0,l.useState)(""),[t,u]=(0,l.useState)([]),[m,x]=(0,l.useState)(!0),[p,b]=(0,l.useState)(0),[h,g]=(0,l.useState)(!1),[f,j]=(0,l.useState)(!1),[y,N]=(0,l.useState)(""),[v,k]=(0,l.useState)(""),[C,S]=(0,l.useState)(null),[w,E]=(0,l.useState)(""),[O,D]=(0,l.useState)(null),[_,L]=(0,l.useState)({});async function F(e){x(!0);let r=50*e,{data:t}=await o.O.from("complexes").select("id, name, code").order("name").range(r,r+50-1),n=(t||[]).map(e=>{var r;return{id:e.id,name:e.name,code:null!==(r=e.code)&&void 0!==r?r:null}}),{data:l}=await o.O.from("units").select("complex_id").limit(1e4),s=new Map;(l||[]).forEach(e=>s.set(e.complex_id,(s.get(e.complex_id)||0)+1)),n.forEach(e=>{e.units=s.get(e.id)||0}),u(n),g(50===n.length),x(!1)}(0,l.useEffect)(()=>{F(p)},[p]);let U=(0,l.useMemo)(()=>{let r=e.toLowerCase().trim();return r?t.filter(e=>e.name.toLowerCase().includes(r)||(e.code||"").toLowerCase().includes(r)):t},[t,e]),A=(0,l.useMemo)(()=>U.filter(e=>_[String(e.id)]),[U,_]),M=[{key:"name",label:"Name",render:e=>C===e.id?(0,n.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83C\uDFE2"}),(0,n.jsx)("input",{autoFocus:!0,className:"rounded-md border border-input bg-background px-2 py-1 text-sm",value:w,onChange:e=>E(e.target.value)}),(0,n.jsx)("button",{className:"px-2 py-1 text-sm rounded-md border border-border",onClick:async()=>{w.trim()&&(await o.O.from("complexes").update({name:w.trim()}).eq("id",e.id),u(r=>r.map(r=>r.id===e.id?{...r,name:w.trim()}:r)),S(null))},children:"Save"}),(0,n.jsx)("button",{className:"px-2 py-1 text-sm rounded-md border border-border",onClick:()=>S(null),children:"Cancel"})]}):(0,n.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,n.jsx)("span",{children:"\uD83C\uDFE2"}),(0,n.jsx)("span",{children:e.name}),(0,n.jsx)("button",{className:"px-2 py-0.5 text-xs rounded-md border border-border",onClick:()=>{S(e.id),E(e.name)},children:"Edit"})]})},{key:"code",label:"Code",render:e=>(0,n.jsx)("span",{className:"inline-flex items-center rounded-full border border-border px-2 py-0.5 text-xs bg-muted/30",children:e.code||"-"})},{key:"units",label:"Units",width:"120px",render:e=>{var r;return(0,n.jsxs)("span",{className:"opacity-80",children:[null!==(r=e.units)&&void 0!==r?r:0," units"]})}},{key:"id",label:"Actions",width:"200px",render:e=>(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>{N(e.name),k(e.code||""),j(!0),S(e.id)},children:"Edit"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>D(e.id),children:"Delete"})]})}];async function R(){if(!y.trim()){j(!1);return}if(C)await o.O.from("complexes").update({name:y.trim(),code:v.trim()||null}).eq("id",C),u(e=>e.map(e=>e.id===C?{...e,name:y.trim(),code:v.trim()||null}:e));else{let{data:e,error:r}=await o.O.from("complexes").insert({name:y.trim(),code:v.trim()||null}).select("id").single();!r&&e&&u(r=>[{id:e.id,name:y.trim(),code:v.trim()||null,units:0},...r])}j(!1),S(null)}async function q(){O&&(await o.O.from("complexes").delete().eq("id",O),u(e=>e.filter(e=>e.id!==O)),D(null))}async function z(){let e=A.map(e=>e.id);e.length&&(await o.O.from("complexes").delete().in("id",e),u(r=>r.filter(r=>!e.includes(r.id))),L({}))}return(0,n.jsxs)(s.N,{children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold mb-2",children:"Complexes"}),(0,n.jsx)(d.o,{query:e,setQuery:r,onSearch:()=>{},right:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(c.j,{filename:"complexes.csv",columns:[{key:"name",label:"Name"},{key:"code",label:"Code"},{key:"units",label:"Units"}],rows:A.length?A:U}),(0,n.jsxs)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:0===A.length,onClick:z,children:["Delete Selected (",A.length,")"]}),(0,n.jsx)("button",{className:"rounded-md bg-primary text-primaryForeground px-3 py-2 text-sm",onClick:()=>{N(""),k(""),j(!0),S(null)},children:"Add Complex"})]})}),(0,n.jsx)(a.w,{columns:M,rows:U,selectable:!0,selected:_,onToggleRow:e=>L(r=>({...r,[String(e.id)]:!r[String(e.id)]})),onToggleAll:e=>{let r={};e&&U.forEach(e=>r[String(e.id)]=!0),L(r)}}),m?(0,n.jsx)("div",{className:"mt-2 text-sm opacity-70",children:"Loading…"}):null,(0,n.jsxs)("div",{className:"flex items-center justify-end gap-2 mt-3",children:[(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:0===p,onClick:()=>b(e=>Math.max(0,e-1)),children:"Prev"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border disabled:opacity-50",disabled:!h,onClick:()=>b(e=>e+1),children:"Next"})]}),(0,n.jsxs)(i.u,{open:f,onClose:()=>j(!1),title:C?"Edit Complex":"Add Complex",children:[(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)("label",{className:"text-sm",children:"Name"}),(0,n.jsx)("input",{className:"rounded-md border border-input bg-background px-3 py-2 text-sm",value:y,onChange:e=>N(e.target.value)}),(0,n.jsx)("label",{className:"text-sm",children:"Code"}),(0,n.jsx)("input",{className:"rounded-md border border-input bg-background px-3 py-2 text-sm",value:v,onChange:e=>k(e.target.value)})]}),(0,n.jsx)("div",{className:"mt-3 flex justify-end",children:(0,n.jsx)("button",{className:"rounded-md bg-primary text-primaryForeground px-3 py-2 text-sm",onClick:R,children:"Save"})})]}),(0,n.jsxs)(i.u,{open:null!==O,onClose:()=>D(null),title:"Confirm Delete",children:[(0,n.jsx)("div",{children:"Are you sure you want to delete this complex?"}),(0,n.jsxs)("div",{className:"mt-3 flex justify-end gap-2",children:[(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:()=>D(null),children:"Cancel"}),(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:q,children:"Delete"})]})]})]})}},5057:function(e,r,t){"use strict";t.d(r,{w:function(){return s}});var n=t(7437),l=t(2265);function s(e){let{columns:r,rows:t,selectable:s,selected:d,onToggleRow:a,onToggleAll:i}=e,[o,c]=(0,l.useState)(null),[u,m]=(0,l.useState)("asc"),x=(0,l.useMemo)(()=>{if(!o)return t;let e=[...t];return e.sort((e,r)=>{let t=e[o],n=r[o];return t<n?"asc"===u?-1:1:t>n?"asc"===u?1:-1:0}),e},[t,o,u]),p=e=>{let{active:r}=e;return(0,n.jsx)("span",{className:"ml-1 text-xs opacity-70",children:r?"asc"===u?"↑":"↓":"↕"})},b=s&&d&&t.length>0&&t.every(e=>d[String(e.id)]);return s&&d&&t.some(e=>d[String(e.id)]),(0,n.jsx)("div",{className:"overflow-x-auto rounded-lg border border-border",children:(0,n.jsxs)("table",{className:"min-w-full text-sm",children:[(0,n.jsx)("thead",{className:"bg-muted/40 sticky top-0 z-10 backdrop-blur",children:(0,n.jsxs)("tr",{children:[s?(0,n.jsx)("th",{className:"p-3 w-[42px]",children:(0,n.jsx)("input",{type:"checkbox","aria-label":"Select all rows",checked:!!b,onChange:e=>null==i?void 0:i(e.target.checked)})}):null,r.map(e=>(0,n.jsxs)("th",{className:"text-left p-3 cursor-pointer select-none",style:{width:e.width},onClick:()=>{var r;o===(r=e.key)?m(e=>"asc"===e?"desc":"asc"):(c(r),m("asc"))},children:[e.label,(0,n.jsx)(p,{active:o===e.key})]},String(e.key)))]})}),(0,n.jsx)("tbody",{className:"bg-card",children:x.map((e,t)=>(0,n.jsxs)("tr",{className:"border-t border-border transition-colors "+(t%2==1?"bg-muted/10 ":"")+(s&&d&&d[String(e.id)]?" bg-primary/5 ":"")+"hover:bg-muted/20",children:[s?(0,n.jsx)("td",{className:"p-3 w-[42px]",children:(0,n.jsx)("input",{type:"checkbox","aria-label":"Select row ".concat(String(e.id)),checked:!!(null==d?void 0:d[String(e.id)]),onChange:()=>null==a?void 0:a(e)})}):null,r.map(r=>(0,n.jsx)("td",{className:"p-3",children:r.render?r.render(e):e[r.key]},String(r.key)))]},String(e.id)))})]})})}},1700:function(e,r,t){"use strict";t.d(r,{j:function(){return l}});var n=t(7437);function l(e){let{filename:r,columns:t,rows:l}=e;return(0,n.jsx)("button",{className:"rounded-md border border-border px-3 py-2 text-sm",onClick:function(){let e=new Blob([t.map(e=>s(String(e.label))).join(",")+"\n"+l.map(e=>t.map(r=>{var t;return s(null==(t=e[r.key])?"":t instanceof Date?t.toISOString():String(t))}).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(e),d=document.createElement("a");d.href=n,d.download=r,d.click(),URL.revokeObjectURL(n)},title:"Export CSV",children:"Export CSV"})}function s(e){return e.includes(",")||e.includes('"')||e.includes("\n")?'"'+e.replace(/"/g,'""')+'"':e}t(2265)},361:function(e,r,t){"use strict";t.d(r,{o:function(){return l}});var n=t(7437);function l(e){let{query:r,setQuery:t,onSearch:l,right:s}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,n.jsx)("input",{className:"w-full md:w-auto flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Search…",value:r,onChange:e=>t(e.target.value)}),(0,n.jsx)("button",{className:"rounded-md bg-primary text-primaryForeground px-3 py-2 text-sm",onClick:l,children:"Search"}),s]})}t(2265)},1962:function(e,r,t){"use strict";t.d(r,{u:function(){return l}});var n=t(7437);function l(e){let{open:r,onClose:t,title:l,children:s}=e;return r?(0,n.jsxs)("div",{className:"fixed inset-0 z-40 flex items-center justify-center",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:t}),(0,n.jsxs)("div",{className:"relative z-10 w-full max-w-md rounded-lg border border-border bg-card p-4 shadow-card",children:[l?(0,n.jsx)("div",{className:"text-lg font-semibold mb-2",children:l}):null,(0,n.jsx)("div",{className:"space-y-3",children:s}),(0,n.jsx)("div",{className:"mt-4 flex justify-end gap-2",children:(0,n.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:t,children:"Close"})})]})]}):null}t(2265)}},function(e){e.O(0,[598,138,183,971,23,744],function(){return e(e.s=3334)}),_N_E=e.O()}]);