(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[421],{5150:function(e,t,s){Promise.resolve().then(s.bind(s,9420))},9420:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var d=s(7437),n=s(2265),a=s(2183),r=s(8935);function i(){let[e,t]=(0,n.useState)([]),[s,i]=(0,n.useState)({}),[l,c]=(0,n.useState)("0-30");async function u(){let e=new Date,[s,d]=await Promise.all([r.O.from("installments").select("id, unit_id, amount_iqd, due_date, paid, units(name, user_id)").eq("paid",!1).lte("due_date",e.toISOString()).limit(2e3),r.O.from("service_fees").select("id, unit_id, amount_iqd, due_date, paid, units(name, user_id)").eq("paid",!1).lte("due_date",e.toISOString()).limit(2e3)]),n=t=>s=>{var d,n;let a=new Date(s.due_date);return{kind:t,id:s.id,unit:(null===(d=s.units)||void 0===d?void 0:d.name)||"-",amount:s.amount_iqd,dueDate:s.due_date,daysOver:Math.floor((+e-+a)/864e5),userId:null===(n=s.units)||void 0===n?void 0:n.user_id}};t([...(s.data||[]).map(n("installment")),...(d.data||[]).map(n("service_fee"))])}(0,n.useEffect)(()=>{u()},[]);let o=(0,n.useMemo)(()=>{let t={"0-30":e=>e>=0&&e<=30,"31-60":e=>e>=31&&e<=60,"61-90":e=>e>=61&&e<=90,"90+":e=>e>90};return e.filter(e=>t[l](e.daysOver))},[e,l]);async function m(){let e=o.filter(e=>s[h(e)]),t=new Date;for(let s of e)await r.O.from("reminders").insert({user_id:s.userId,target_type:s.kind,target_id:s.id,schedule_at:t.toISOString(),channel:"push",template_code:l});i({})}function h(e){return"".concat(e.kind,":").concat(e.id)}return(0,d.jsxs)(a.N,{children:[(0,d.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Dunning"}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[["0-30","31-60","61-90","90+"].map(e=>(0,d.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border "+(l===e?"bg-muted/30":""),onClick:()=>c(e),children:e},e)),(0,d.jsx)("div",{className:"flex-1"}),(0,d.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-border",onClick:m,children:"Send Reminders"})]}),(0,d.jsx)("div",{className:"overflow-x-auto rounded-lg border border-border",children:(0,d.jsxs)("table",{className:"min-w-full text-sm",children:[(0,d.jsx)("thead",{className:"bg-muted/40",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"p-2"}),(0,d.jsx)("th",{className:"p-2 text-left",children:"Unit"}),(0,d.jsx)("th",{className:"p-2 text-left",children:"Due Date"}),(0,d.jsx)("th",{className:"p-2 text-left",children:"Days Over"}),(0,d.jsx)("th",{className:"p-2 text-left",children:"Amount"}),(0,d.jsx)("th",{className:"p-2 text-left",children:"Type"})]})}),(0,d.jsx)("tbody",{children:o.map(e=>(0,d.jsxs)("tr",{className:"border-t border-border",children:[(0,d.jsx)("td",{className:"p-2",children:(0,d.jsx)("input",{type:"checkbox",checked:!!s[h(e)],onChange:()=>{var t;return t=h(e),void i(e=>({...e,[t]:!e[t]}))}})}),(0,d.jsx)("td",{className:"p-2",children:e.unit}),(0,d.jsx)("td",{className:"p-2",children:new Date(e.dueDate).toLocaleDateString()}),(0,d.jsx)("td",{className:"p-2",children:e.daysOver}),(0,d.jsx)("td",{className:"p-2",children:e.amount}),(0,d.jsx)("td",{className:"p-2",children:e.kind})]},h(e)))})]})})]})}}},function(e){e.O(0,[598,138,183,971,23,744],function(){return e(e.s=5150)}),_N_E=e.O()}]);