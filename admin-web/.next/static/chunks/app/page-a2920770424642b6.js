(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3869:function(e,t,s){Promise.resolve().then(s.bind(s,890))},890:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var a=s(7437),n=s(2265),r=s(9839);function l(e){let{className:t,variant:s="primary",...n}=e;return(0,a.jsx)("button",{className:(0,r.cn)("inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50 disabled:pointer-events-none",{primary:"bg-primary text-primaryForeground hover:opacity-95",ghost:"hover:bg-muted text-foreground"}[s],t),...n})}function i(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,r.cn)("bg-card text-cardForeground rounded-lg shadow-card border border-border",t),...s})}function c(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,r.cn)("p-4",t),...s})}function d(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,r.cn)("p-4 pt-0",t),...s})}var o=s(7003);function u(e){let{title:t,value:s,spark:n,delta:r,locale:l="en-IQ"}=e;return(0,a.jsxs)(i,{className:"min-w-[200px]",children:[(0,a.jsx)(c,{children:(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:t})}),(0,a.jsxs)(d,{children:[(0,a.jsxs)("div",{className:"text-2xl font-semibold flex items-center gap-2",children:[(0,o.y)(s,l),"number"==typeof r?(0,a.jsxs)("span",{className:"text-xs px-2 py-0.5 rounded-full border "+(r>=0?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200"),children:[r>=0?"▲":"▼"," ",Math.abs(r),"%"]}):null]}),n?(0,a.jsx)("div",{className:"mt-2",children:n}):null]})]})}function m(e){let{values:t,stroke:s="hsl(var(--primary))"}=e;if(!t.length)return null;let n=Math.min(...t),r=Math.max(...t)-n||1,l=t.map((e,s)=>[s/(t.length-1)*120,32-(e-n)/r*32]).map((e,t)=>{let[s,a]=e;return 0===t?"M ".concat(s,",").concat(a):"L ".concat(s,",").concat(a)}).join(" ");return(0,a.jsx)("svg",{width:120,height:32,viewBox:"0 0 ".concat(120," ").concat(32),"aria-hidden":!0,children:(0,a.jsx)("path",{d:l,fill:"none",stroke:s,strokeWidth:2,strokeLinecap:"round"})})}function x(e){let{className:t,...s}=e;return(0,a.jsx)("span",{className:(0,r.cn)("inline-flex items-center rounded-full border border-border px-2 py-0.5 text-xs",t),...s})}function p(e){let{status:t}=e;return(0,a.jsx)(x,{className:{paid:"bg-green-100 text-green-700 border-green-200",due:"bg-yellow-100 text-yellow-800 border-yellow-200",overdue:"bg-red-100 text-red-700 border-red-200"}[t],children:t.toUpperCase()})}function h(e){let{rows:t,locale:s="ar-IQ"}=e,[r,l]=(0,n.useState)("dueDate"),[i,c]=(0,n.useState)("asc"),d=(0,n.useMemo)(()=>{let e=[...t];return e.sort((e,t)=>{let s=e[r],a=t[r];return("dueDate"===r&&(s=new Date(s).getTime(),a=new Date(a).getTime()),"amount"===r&&(s=e.amount,a=t.amount),s<a)?"asc"===i?-1:1:s>a?"asc"===i?1:-1:0}),e},[t,r,i]);function u(e){r===e?c(e=>"asc"===e?"desc":"asc"):(l(e),c("asc"))}function m(e){let{active:t,dir:s}=e;return(0,a.jsx)("span",{className:"ml-1 text-xs opacity-70",children:t?"asc"===s?"↑":"↓":"↕"})}return(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg border border-border",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-muted/40 sticky top-0 z-10 backdrop-blur",children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{className:"text-left p-3 cursor-pointer select-none",onClick:()=>u("unit"),children:["Unit",(0,a.jsx)(m,{active:"unit"===r,dir:i})]}),(0,a.jsxs)("th",{className:"text-left p-3 cursor-pointer select-none",onClick:()=>u("dueDate"),children:["Due Date",(0,a.jsx)(m,{active:"dueDate"===r,dir:i})]}),(0,a.jsxs)("th",{className:"text-left p-3 cursor-pointer select-none",onClick:()=>u("amount"),children:["Amount",(0,a.jsx)(m,{active:"amount"===r,dir:i})]}),(0,a.jsxs)("th",{className:"text-left p-3 cursor-pointer select-none",onClick:()=>u("status"),children:["Status",(0,a.jsx)(m,{active:"status"===r,dir:i})]})]})}),(0,a.jsx)("tbody",{className:"bg-card",children:d.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t border-border transition-colors "+(t%2==1?"bg-muted/10":"")+" hover:bg-muted/20",children:[(0,a.jsx)("td",{className:"p-3",children:e.unit}),(0,a.jsx)("td",{className:"p-3",children:(0,o.p)(e.dueDate,s)}),(0,a.jsx)("td",{className:"p-3",children:(0,o.y)(e.amount,s)}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)(p,{status:e.status})})]},e.id))})]})})}var j=s(2183),f=s(8935);function v(e){let{title:t,value:s}=e;return(0,a.jsxs)(i,{className:"min-w-[200px]",children:[(0,a.jsx)(c,{children:(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:t})}),(0,a.jsx)(d,{children:(0,a.jsx)("div",{className:"text-2xl font-semibold",children:s})})]})}function g(){let[e,t]=(0,n.useState)("all"),[s,r]=(0,n.useState)([]),[c,o]=(0,n.useState)({dueToday:0,next30:0,pastDue:0,collectedMtd:0}),[x,p]=(0,n.useState)([]),[g,N]=(0,n.useState)(!0),[b,y]=(0,n.useState)(0),[w,_]=(0,n.useState)(0),[D,k]=(0,n.useState)(0),[C,S]=(0,n.useState)(0),[O,M]=(0,n.useState)([]);(0,n.useEffect)(()=>{(async()=>{N(!0);let e=new Date,{data:t}=await f.O.from("installments").select("id, amount_iqd, due_date, paid, units(name)").order("due_date",{ascending:!0}).limit(50);r((t||[]).map(t=>{var s,a;let n=t.due_date,r=new Date(n),l=t.paid?"paid":r<e?"overdue":"due";return{id:String(t.id),unit:(null===(s=t.units)||void 0===s?void 0:s.name)||"Unit ".concat(null!==(a=t.unit_id)&&void 0!==a?a:""),dueDate:n,amount:t.amount_iqd,status:l}}));let[{data:s},{data:a},{data:n},{data:l}]=await Promise.all([f.O.rpc("sum_due_today"),f.O.rpc("sum_next_30"),f.O.rpc("sum_past_due"),f.O.rpc("sum_collected_mtd")]);o({dueToday:s,next30:a,pastDue:n,collectedMtd:l});let{data:i}=await f.O.from("payments").select("paid_at, amount, units(name)").eq("status","paid").order("paid_at",{ascending:!1}).limit(5);p((i||[]).map(e=>{var t,s;return{title:"Payment from ".concat(null!==(s=null===(t=e.units)||void 0===t?void 0:t.name)&&void 0!==s?s:"Unit"),when:e.paid_at?new Date(e.paid_at).toLocaleString():""}}));let[c,d,u,m,x]=await Promise.all([f.O.from("user_roles").select("user_id",{count:"exact",head:!0}),f.O.from("complexes").select("*",{count:"exact",head:!0}),f.O.from("units").select("*",{count:"exact",head:!0}),f.O.from("user_status").select("*",{count:"exact",head:!0}).eq("status","pending"),f.O.from("client_complex_status").select("*",{count:"exact",head:!0}).eq("status","pending")]);y(c.count||0),_(d.count||0),k(u.count||0),S((m.count||0)+(x.count||0));let{data:h}=await f.O.from("user_roles").select("role, profiles(email)").order("role").limit(5);M((h||[]).map(e=>{var t;return{email:(null===(t=e.profiles)||void 0===t?void 0:t.email)||"—",role:e.role}})),N(!1)})()},[]);let U=(0,n.useMemo)(()=>"all"===e?s:s.filter(t=>t.status===e),[s,e]);return(0,a.jsx)(j.N,{children:(0,a.jsxs)("main",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Dashboard"})}),(0,a.jsx)(i,{className:"kpi-gradient text-white",children:(0,a.jsx)(d,{className:"py-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)(u,{title:"Due Today",value:c.dueToday,spark:(0,a.jsx)(m,{values:[4,6,3,8,7,10,9]})}),(0,a.jsx)(u,{title:"Next 30 Days",value:c.next30,spark:(0,a.jsx)(m,{values:[10,9,11,12,10,8,9]})}),(0,a.jsx)(u,{title:"Past Due",value:c.pastDue,spark:(0,a.jsx)(m,{values:[7,6,7,9,8,7,6]})}),(0,a.jsx)(u,{title:"Collected MTD",value:c.collectedMtd,spark:(0,a.jsx)(m,{values:[5,7,9,12,14,13,15]})})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)(v,{title:"Users",value:b}),(0,a.jsx)(v,{title:"Complexes",value:w}),(0,a.jsx)(v,{title:"Units",value:D}),(0,a.jsx)(v,{title:"Pending Approvals",value:C})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l,{variant:"all"===e?void 0:"ghost",onClick:()=>t("all"),children:"All"}),(0,a.jsx)(l,{variant:"due"===e?void 0:"ghost",onClick:()=>t("due"),children:"Due"}),(0,a.jsx)(l,{variant:"overdue"===e?void 0:"ghost",onClick:()=>t("overdue"),children:"Past Due"}),(0,a.jsx)(l,{variant:"paid"===e?void 0:"ghost",onClick:()=>t("paid"),children:"Paid"})]}),(0,a.jsx)(h,{rows:U}),(0,a.jsx)(i,{children:(0,a.jsxs)(d,{className:"py-4",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-2",children:"Recent Activity"}),(0,a.jsxs)("ul",{className:"space-y-2",children:[x.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:e.title}),(0,a.jsx)("span",{className:"text-xs opacity-70",children:e.when})]},t)),0===x.length?(0,a.jsx)("li",{className:"text-sm opacity-70",children:"No recent payments"}):null]})]})}),(0,a.jsx)(i,{children:(0,a.jsxs)(d,{className:"py-4",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-2",children:"Recent Users"}),(0,a.jsxs)("ul",{className:"space-y-2",children:[O.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:e.email}),(0,a.jsx)("span",{className:"text-xs opacity-70",children:e.role.toUpperCase()})]},t)),0===O.length?(0,a.jsx)("li",{className:"text-sm opacity-70",children:"No users"}):null]})]})})]})})}},7003:function(e,t,s){"use strict";function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-IQ";return new Intl.NumberFormat(t,{style:"currency",currency:"IQD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ar-IQ",s="string"==typeof e?new Date(e):e;return new Intl.DateTimeFormat(t,{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"UTC"}).format(s)}s.d(t,{p:function(){return n},y:function(){return a}})}},function(e){e.O(0,[598,138,183,971,23,744],function(){return e(e.s=3869)}),_N_E=e.O()}]);